\documentclass[12pt, letterpaper, twoside]{article}
\usepackage[utf8]{inputenc}
\usepackage[margin=1in]{geometry}
\usepackage{graphicx}
\usepackage{float}
\usepackage{color}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{spverbatim}
\usepackage{fancyvrb}
\usepackage{fvextra}
\title{}
\author{}
%
\makeatletter
\setlength{\@fptop}{0pt}
\makeatother
%

\begin{document}
\maketitle

\section{Bitcoin peer-to-peer protocol}\label{netintro}
Introduction to BTC network, has to glue together all the parts of this section. Clients versions/ variants - how different clients interact - networking interface almost untouched. This thesis refers to latest version of bitcoin core.
\subsection{Connection and peer discovery}\label{peerdisc}
In order to establish a connection two peers need to exchange version messages on a TCP channel, by default on port 8333, in an handshake fashion. The node that first sends a \texttt{version} message is said to be establishing an \emph{outgoing connection}. The receiving peer will eventually send back a \texttt{verack} message followed by another \texttt{version} message. This latter node is said to be establishing an \emph{ingoing connection}. Once the second \texttt{version} message is answered with a \texttt{verack} the connection is set up. Each node is able to establish up to 8 outgoing connections and 117 ingoing connections, for a total of 125 connections. In order to keep its connections active, each peer sends a message to each neighbour at least once every thirty minutes. If more ninety minutes pass without receiving anything from a neighbour, the connection is dropped. Each node always tries to keep eight outgoing connections active, therefore upon dropping an outgoing connection a node tries to connect to another address from its peer cache.\\
Nodes on fresh bootstrap make use of hardcoded \emph{DNS seeds} as their first mean to discover other peers. DNS seed servers are maintained by community members and answer queries providing a list of addresses that can be either dynamically gathered through a periodic scan of the network or manually updated by server administrators. As a fallback option the user is able through command line to specify a list of addresses the client can connect to. Were both these two options to fail the client has a hardcoded list of peers it can directly connect to, though this is considered the last resort for bootstrapping peers. Nodes on startup that were previously in the network shall first lookup for peer names in their local address database, implemented as "peer.dat". The database contains the address of each peer the node has come to know during its lifetime in the network. If the node has disconnected for a time too long, many of the addresses in the database may have become outdated or unreachable. A node that cannot connect to any address in the peer database or has spent up to eleven seconds trying to connect unsuccessfully to at least one of the peers in the database behaves as on fresh bootstrap and resolves to query a DNS first. The use of a local address database, also called \emph{peer cache}, provides reconnecting peers a fully-decentralized way to join the network and is the first line of defence against \emph{fake bootstrap attacks}; the topic along with other security concerns will be discussed in Chapter \ref{securityintro}.\\
The peer discovery process after the first connection of a node is carried on through the exchange of \texttt{addr} messages containing the address and port number of other peers in the network. Once a connection has been set up the two nodes exchange \texttt{addr} messages, providing each other with addresses from their local peer database. Furthermore every twenty-four hours each node sends to its neighbours an \texttt{addr} message containing only its own address in order to advertise itself in the network. \texttt{addr} messages can contain at most one thousand addresses; additionally those containing ten or fewer addresses are relayed. This behaviour greatly contributes to the gossiping of self-advertisement messages even though messages are relayed only to a small subset of neighbours, namely to a couple of peers.

\section{Bitcoin Network Security Issues}\label{securityintro}
-network attacks on bitcoin\\
-atks that operate on peer cache\\
Peer caches have been widely implemented so far as they are a fast and fully-decentralized way to rejoin the network after a disconnection. They allow P2P systems to overcome other major issues at bootstrap time related to presence of a single point of failure, i.e. bootstrap servers, and are the most scalable and efficient solution when compared to other decentralized mechanisms such as \textit{address probing} \cite{decentrbootstrapp2p}.
Nevertheless, the use of peer caches introduces new security concerns for the network:
the manipulation of the peer database performed by one or more cooperating malicious nodes can easily lead to the monopolization of a node, or group of nodes, connections', thus creating a network partition. This condition, often referred to as the \textit{eclipsing} of node, is inherently dangerous for it leaves the victim open to \textit{double-spend}, \textit{selfish mining} and \textit{51\%} attacks. More can be found in the following sections.

\subsubsection{Peer database structure}\label{cachestruct}
The local peer database or cache serves the purpose of storing the addresses a node has come to know from \texttt{addr} messages and DNS seeds. The database is constituted of the \texttt{new} and the \texttt{tried} tables. The latter contains addresses of peers with whom the node has successfully established a connection in the past. It consists of 64 buckets that can store up to 64 unique addresses. Buckets are selected through a hash on the IP address. The \texttt{new} table contains the addresses the node has not connected to and is therefore larger: it has 256 buckets of 64 addresses each.\\

\subsection{Eclipse attack}\label{eclipse}
During an eclipse attack the victim is flooded with a multitude of incoming connections from an attacker and fed with bogus network information, i.e. peer addresses, that will fill up the peer cache. Upon restarting with high probability the victim will form all of its eight outgoing connections with malicious IP addresses, thus finding itself eclipsed. As described in Section \ref{securityintro} this greatly enhances the efficacy and impact of other attacks. In 2015, Heilman et al. widely describe eclipse attacks on the Bitcoin network and suggested many countermeasures to harden the network, a few of which were implemented \cite{eclipseatk}. As part of the adoption of these countermeasures, the number of buckets in \texttt{new} and \texttt{tried} has been increased, the addresses have become deterministically hashed to a single slot inside a bucket and the heavy bias towards addresses with fresher timestamps when choosing new connections has been removed.

\subsection{Fake bootstrapping attack}\label{fakeboot}
Every P2P system needs some mean to let nodes join the network: in Bitcoin bootstrapping nodes need to rely on the information provided by some other peer in the network. In a fake bootstrapping attack the peers contacted while a node is still initiating its connections, and hence its knowledge of the network, flood the bootstrapping peer with malicious addresses. The results in Chapter \ref{res} show how feeding bogus information to a joining node can seriously influence its view of the network and lead to network partitions and peer eclipsing. This condition would also increase the efficacy of other network-level attacks, such as a DDoS, and the success rate of spending and mining attacks \cite{eclipseatk}.\\
Prevention is done by ensuring a node can contact a trustworthy peer when joining the network. Peer caches and centralized reliable bootstrap services serve this purpose, allowing joining nodes to make use of old neighbours while having central bootstrap servers as a fallback. Other solutions have been implemented and tested over time, though their drawbacks usually exceed the benefits. Randomly probing the address space, scouting for peers, decentralizes the bootstrap process and increases the variance in the network knowledge, but may not work if peers are behind NATs or firewalls and increases the latency for joining the network \cite{decentrbootstrapp2p} \cite{localityaware}. In 2012,  Touceda et al. widely treated fake bootstrapping along with other security threats in their survey \cite{toucedafakeboot}.\\
Bitcoin employs many countermeasures, and overcomes other bootstrap issues, with its peer cache implementation mixed with external mechanisms: each node contacts its stored addresses for successive connections and aims to establish multiple outgoing connections, thus it does not rely on a single bootstrap node. Were the peer cache to fail, DNS seeds provide a reliable bootstrap service. Finally the user is given the ability so manually insert addresses to connect to \cite{mahmoud_netsec_boot}.

\section{Results}\label{res}


















\bibliographystyle{plain}
\bibliography{bib.bib}

\end{document}